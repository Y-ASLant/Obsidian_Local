## 涉及知识
----

> TMOD 工作方式控制寄存器  不能位寻址   
> ![[../ASLant_Files/5eac24f36e61f8d6d3c4bf3b4a0f445e_MD5.jpg]]
  
- TCON 定时器/计数器控制寄存器   **可位寻址**   
  
- IE 中断允许寄存器  **可位寻址**   

## AT89C51 
----
![[../ASLant_Files/7fb79239787366a02335efe780e0b265_MD5.jpg]]       

## 题目要求 
----
> 在下图所示原理图中，P1口接有8个LED灯,请采用定时器T0的方式1的定时中断方式，使P1口外接的8个LED灯**同时**每0.5s闪亮一次


## 仿真图  
----
![[../ASLant_Files/7df7d840287b374e2222931230d7c6a1_MD5.jpg]]  

> [`仿真源文件`](https://www.123pan.com/s/N7orVv-DbMV3.html)  


## 源代码  
----
```c
#include <reg51.h>

char i = 100;
void main()
{
    TMOD = 0x01;//定时器模式 ，且GATE = 0，此时仅有TRx位控制定时器，计数器的运行，且M1,M0为01为第一种工作方式  16位
    TH0 = 0xee;//设置初始数值
    TL0 = 0x00;//设置初始数值

    //则初始值为0xEE00 = 60928
    //最大值 65536

    P1 = 0x00;
    EA = 1; //中断允许总开关控制位 EA = 1 所有中断请求允许 ； EA = 0 所有中断请求拒绝 ； 
    ET0 = 1; //ET0：定时器/计数器T0 的溢出中断允许位；ET0 = 1 允许中断
    TR0 = 1; //等于1 启动定时器计数器工作
    while (1)
    {
        ;
    }
}
void timer0() interrupt 1
{
    TH0 = 0xee;
    TL0 = 0x00;
    i--;
    if (i <= 0)
    {
        P1 = ~P1;
        i = 100;
    }
}
``` 


## 代码解析
----
```c
这段代码是使用 Keil C 编写的基于 8051 单片机的程序，实现了一个定时器中断的功能。以下是对代码的解析：

1. `#include <reg51.h>`：这是包含 8051 单片机寄存器定义的头文件，用于访问特定的寄存器和位。

2. `char i = 100;`：声明一个名为 `i` 的字符变量，并初始化为 100。

3. `void main()`：这是主函数，程序从这里开始执行。

4. `TMOD = 0x01;`：设置定时器/计数器 T0 的工作模式为 16 位定时器模式。

5. `TH0 = 0xee;` 和 `TL0 = 0x00;`：设置定时器/计数器 T0 的初始计数值为 0xEE00。

6. `P1 = 0x00;`：将 P1 端口的值设置为 0x00。

7. `EA = 1;`：设置总中断使能位，允许中断请求。

8. `ET0 = 1;`：允许定时器/计数器 T0 的溢出中断。

9. `TR0 = 1;`：启动定时器/计数器 T0 的工作。

10. `while (1) { ... }`：进入一个无限循环，程序会在这里一直循环执行。

11. `void timer0() interrupt 1`：这是定时器/计数器 T0 的中断服务子程序。当 T0 溢出时，会触发此中断。

12. `TH0 = 0xee;` 和 `TL0 = 0x00;`：在中断服务子程序中重新设置定时器/计数器 T0 的初始计数值。

13. `i--;`：每次中断服务时，将 `i` 减 1。

14. `if (i <= 0)`：检查 `i` 是否小于等于 0。

15. `P1 = ~P1;`：将 P1 端口的值取反，即将 P1 的当前值取反并写入 P1 端口，实现了 P1 端口的翻转。

16. `i = 100;`：将 `i` 的值重新设置为 100，重新开始计数。

整体上，这段代码通过定时器中断实现了一个周期性翻转 P1 端口的功能。每次定时器 T0 溢出时，会触发中断，将 P1 端口的值取反，然后重新计数，周期性地重复这个过程。通过修改定时器初始值和调整 `i` 的值，可以控制翻转的频率和持续时间。
```



## 效果预览
----
![[../ASLant_Files/38c864de3c0acc361d88b4946ac06c89_MD5.gif]]