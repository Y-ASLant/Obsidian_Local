## 题目要求
----
> 用单片机的P1.7\~P1.4接4*4矩阵式键盘的**行线**，P1.3\~P1.0接矩阵式键盘的**列线**，P0口外接数码管，数码管显示键盘中闭合的按键编号。       
> 
> - 判别是否有键按下，若有，进入第（2）步。  
> - 识别哪一个键被按下，并求出相应的键值。   
> - 根据键值，找到相应键值处理程序入口。 
> 

## 仿真图   
-----
![[ASLant_Images/3583e9742102d6da46e47210f1e81095_MD5.jpg]]

> [`仿真源文件`](https://aslant.top/123pan/?d=N7orVv-P1MV3.html)  
## 源代码
----
```c
#include <reg51.h>
#define uchar unsigned char
sbit L1 = P1 ^ 0;
sbit L2 = P1 ^ 1;
sbit L3 = P1 ^ 2;
sbit L4 = P1 ^ 3;
//0 ~ F
uchar dis[16] = {0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90, 0x88, 0x83, 0xc6, 0xa1, 0x86, 0x8e};
unsigned int time;

void delay50ms(void) // 误差 0us
{
    unsigned char a, b;
    for (b = 173; b > 0; b--)
        for (a = 143; a > 0; a--)
            ;
}

void main()
{
    uchar temp;
    uchar k, i;
    while (1)
    {
        P1 = 0xef;
        for (i = 0; i <= 3; i++)
        {
            if (L1 == 0)
            {
                P0 = dis[i * 4 + 0];
            }
            if (L2 == 0)
            {
                P0 = dis[i * 4 + 1];
            }
            if (L3 == 0)
            {
                P0 = dis[i * 4 + 2];
            }
            if (L4 == 0)
            {
                P0 = dis[i * 4 + 3];
            }
            delay50ms();
            temp = P1;
            temp = temp | 0x0f;
            temp = temp << 1;
            temp = temp | 0x0f;
            P1 = temp;
        }
    }
}
```    
 
## 代码解析
----
```c
这段代码是使用 Keil C 编写的基于 8051 单片机的程序，实现了一个简单的数码管动态显示的功能。以下是对代码的解析：

1. `#include <reg51.h>`：这是包含 8051 单片机寄存器定义的头文件，用于访问特定的寄存器和位。

2. `#define uchar unsigned char`：定义了一个 `uchar` 类型，表示无符号字符。

3. `sbit L1 = P1 ^ 0;`、`sbit L2 = P1 ^ 1;`、`sbit L3 = P1 ^ 2;`、`sbit L4 = P1 ^ 3;`：使用 `sbit` 定义了四个位变量，分别表示 P1 端口的 0、1、2、3 位引脚，用于控制数码管的显示。

4. `uchar dis[16] = {0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90, 0x88, 0x83, 0xc6, 0xa1, 0x86, 0x8e};`：定义了一个长度为 16 的数组 `dis`，存储了数码管显示 0 ~ F 的对应段码值。

5. `unsigned int time;`：定义了一个无符号整数变量 `time`。

6. `void delay50ms(void)`：定义了一个延时函数 `delay50ms()`，用于产生大约 50 毫秒的延时。

7. `void main()`：这是主函数，程序从这里开始执行。

8. `uchar temp;`：定义了一个名为 `temp` 的无符号字符变量。

9. `uchar k, i;`：定义了两个无符号字符变量 `k` 和 `i`。

10. `while (1) { ... }`：进入一个无限循环，程序会在这里一直循环执行。

11. `P1 = 0xef;`：将 P1 端口的 4 位设置为高电平（逻辑1），并将 0 位设置为低电平（逻辑0），用于选择要显示的数码管。

12. `for (i = 0; i <= 3; i++) { ... }`：循环四次，依次控制四个数码管的显示。

13. `if (L1 == 0) { ... }`、`if (L2 == 0) { ... }`、`if (L3 == 0) { ... }`、`if (L4 == 0) { ... }`：检测当前选中的数码管是否被按下（即对应的引脚是否为低电平），如果是，则根据当前循环的索引 `i` 选择对应的段码值，并将其赋值给 P0 端口，以控制数码管的显示。

14. `delay50ms();`：调用延时函数，产生大约 50 毫秒的延时。

15. `temp = P1;`：将 P1 端口的值赋给 `temp` 变量。

16. `temp = temp | 0x0f;`：将 `temp` 的低 4 位设置为高电平，保持数码管的选中状态。

17. `temp = temp << 1;`：将 `temp` 左移一位，为下一次循环准备。

18. `temp = temp | 0x0f;`：将 `temp` 的低 4 位设置为高电平，保持数码管的选中状态。

19. `P1 = temp;`：将更新后的 `temp` 值赋给 P1 端口，控制数码管的选中。

整体上，这段代码实现了一个数码管的动态显示功能。通过不断循环选择数码管，并根据按下的按键来显示对应的数字，实现了数码管的动态效果。
```

## 效果预览
----
![[ASLant_Images/d2bace49bfe29ad1dc9000d29bf01b4a_MD5.gif]]