# 2024.05.22 华清远见实训日报
# 串口通信
###### 以下图片来大三上学期制作的 PPT
![[../ASLant_Files/2e5b76ca3ceb86a37c37c0945ed2a144_MD5.jpg]]

![[../ASLant_Files/4b49d07c36009e0118abfed7cbc61b24_MD5.jpg]]

![[../ASLant_Files/a1407b386a0db2242f5e6c8a88854684_MD5.jpg]]
### 根据有无时钟线
![[../ASLant_Files/f7aee7371293f21675a911026da7faf5_MD5.jpg]]

> [!BUG] [[机械臂_0x03#讲个故事|故事带入]]

### 根据传输数据方式
![[../ASLant_Files/2f957466b0b5a5eea8f17f4381131168_MD5.jpg]]

### 根据通信特性

**单工通信**：单工通信只支持信号在一个方向上传输（正向或反向），任何时候不能改变信号的传输方向。

**半双工通信**：半双工通信允许信号在两个方向上传输，但某一时刻只允许信号在一个信道上单向传输。

**全双工通信**：全双工通信允许数据**同时**在两个方向上传输，即有两个信道，因此允许同时进行双向传输。

# 串口连接方式

![[../ASLant_Files/ce9595a69a88b36529e3b174503e4d77_MD5.jpg]]

![[../ASLant_Files/af11a28234779dbdf3e1dc97834ce33b_MD5.jpg]]

# 串口输出 Hello World

### CUBEMX 配置

> [!BUG] 波特率：115200

![[../ASLant_Files/73c3f2cad80038edd9a30c06a6efa143_MD5.jpg]]

> [!info] 在 while (1)中添加
> 定义 Buff 在 while (1) 外，main 函数中

```c
  uint8_t Buff[32]="Hello World";
  HAL_UART_Transmit(&huart1,Buff,sizeof(Buff),0xFFFF);
  HAL_UART_Transmit(&huart1,(uint8_t*)"\r",4,0xFFFF); //换行
```

> [!BUG]  \\n 无法换行
 
# 串口中断控制 LED

### 全局变量
```c
unsigned char  data_1;
```
### 开启中断
```c
HAL_UART_Receive_IT(&huart1,&data_1,1);
```

### 重写中断回调函数
```c
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
    if(huart->Instance==USART1)
    {
        if(data_1=='o')
        {
            HAL_GPIO_WritePin(LED1_GPIO_Port,LED1_Pin,GPIO_PIN_RESET);

        } else if(data_1=='f')
        {
            HAL_GPIO_WritePin(LED1_GPIO_Port,LED1_Pin,GPIO_PIN_SET);

        }
        HAL_UART_Receive_IT(&huart1,&data_1,1);
    }
}
```

# 串口重定向

### 注意事项

> [!BUG] 需要勾选 MicroLib

![[../ASLant_Files/a8c425eb54a2a2d89ac5974e6968f16a_MD5.jpg]]

### 重写 fputc 函数

> [!BUG] 注意头文件引用
> ```c
> #include <stdio.h>
> ```

```c
int fputc(int ch, FILE *f)
{
  HAL_UART_Transmit(&huart1, (uint8_t *)&ch, 1, 0xffff);
  return ch;
}
```

# ADC 基本工作原理

> [! INFO] 通过一系列的采样和量化过程来实现模拟到数字的转换

1. **采样**（Sampling）：ADC 根据一定的时间间隔，从模拟信号中获取一系列离散的采样点。采样率决定了采样点的密度，较高的采样率可以更精确地表示原始模拟信号。
2. **量化**（Quantization）：采样得到的模拟信号样本通常是连续的，量化则将每个采样点映射为一个特定的数字值。量化过程将连续的模拟信号离散化，并分配给每个样本一个数字值。
3. **编码**（Encoding）：编码将量化后的数字值表示为二进制形式，以便于数字系统处理。常见的编码方式包括无符号二进制、补码和格雷码等。

### 转换公式

![[../ASLant_Files/5f2a8c94a22aed30a61bb91539d641ac_MD5.jpg]]

### ADC五种采样模式

1. **单通道扫描模式**：在这种模式下，ADC 依次对单个通道进行采样转换。

2. **多通道扫描模式**：ADC 在这种模式下可以按照预先设定的顺序对多个通道进行采样转换。

3. **间隔采样模式**：ADC 在一定时间间隔内对信号进行采样，适用于需要对信号进行连续监测的场景。

4. **事件驱动采样模式**：ADC 在接收到特定事件触发时进行采样转换，适用于需要对特定事件进行监测的场景。

5. **连续采样模式**：ADC 在不间断地对信号进行采样转换，常用于需要持续监测信号变化的场景。

### 使用单通道单次转换步骤

```text
1.启动ADC
2.等待转换
3.获取转换后的值
4.停止转换
```



















































# 讲个故事
```text
老张爱喝茶，废话不说，煮开水。
出场人物：老张，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。

1 老张把水壶放到火上，立等水开。（同步阻塞）
老张觉得自己有点傻

2 老张把水壶放到火上，去客厅看电视，时不时去厨房看看水开没有。（同步非阻塞）
老张还是觉得自己有点傻，于是变高端了，买了把会响笛的那种水壶。水开之后，能大声发出嘀~~~~的噪音。

3 老张把响水壶放到火上，立等水开。（异步阻塞）
老张觉得这样傻等意义不大

4 老张把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。（异步非阻塞）
老张觉得自己聪明了。
```

