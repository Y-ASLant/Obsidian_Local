# 2024 .05.27 华清远见实训日报
> [!BUG] LED 以 500 ms 闪烁，当按下按键时，向串口发送 Welcom to ShanDong

# 定时器
### 一、一般方式
![[../ASLant_Files/6a1ec98bba58bc6be769b88285ae5d7b_MD5.jpg]]

### 代码
```c
LED_500ms();
if (key_Scan() == 1)
{
  printf("Welcome to ShanDong \r");
}
```

### 二、中断方式
#### CUBEMX 配置
![[../ASLant_Files/0b23acf7d2d95fb1d944e3834ee5b410_MD5.jpg]]

#### Keil 5 代码
while (1) 中
```c
LED_500ms();
```

while (1) 之外
```c
void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
  printf("Welcom to ShanDong\r");
}
```

### 转换关系
```math
1MHz = 10^6Hz
1ms = 1000us
```

![[../ASLant_Files/daefdedf023a8e6d53bcdbd2e77fb60c_MD5.jpg]]

```c
720*10000/72000000==>0.1s==>100ms
```

# PWM 脉冲宽度调制

> [!NOTE] PWM 全称为脉冲宽度调制（Pulse Width Modulation），是利用微处理器的数字输出来对模拟电路进行控制的一种技术。它通过改变信号脉冲的宽度来等效获得所需要合成的相应幅值和频率的波形，从而获得控制电路或装置的输出功率或电压。多应用于 LED 灯亮度调节、电机调速、舵机转角调节等场合。

### 占空比：指在一周期内高电平的占比
![[../ASLant_Files/9e1f25d5d6a0e0d6ebaf4697ab24a3c3_MD5.jpg]]
```text
如图截取两个周期的信号，该信号周期是10ms。
第一个周期高电平保持7ms，低电平保持3ms；
第二个周期高电平保持4ms，低电平保持6ms；
所以第一个周期的占空比是70%，第二个周期的占空比是40%
```

![[../ASLant_Files/b75765c31da427f5e2f29372684310b7_MD5.jpg]]

```text
面积等效原理：输出 = 输入 × 占空比
当输入电压为5V：
占空比为20%，平均电压就是1V；
占空比为50%，平均电压就是2.5V；
占空比为75%，平均电压就是3.75V；
占空比越大，所得到的平均电压就越大，幅值也就越大；
占空比越小，所得到的平均电压就越小，幅值也就越小
```

![[../ASLant_Files/4dc4afcb2174efb7489be036915e7558_MD5.gif]]
# 舵机原理
![[../ASLant_Files/45f1491b4cf99454b43c5e3658b5cb8b_MD5.jpg]]

![[../ASLant_Files/480c15ace0108bc789c52eae5c901afb_MD5.jpg]]

![[../ASLant_Files/4b14f0d0f2b185d110bde7106b84e09a_MD5.gif]]

控制舵机的信号是周期为 20 ms 的 PWM，一个周期的高电平的范围是 0.5~2.5 ms，其他时间为低电平。只要改变占空比就能让舵机转动，0~180°

# PWM 控制舵机复位 (直立)

| ![[../ASLant_Files/a9e1136b74dc5d03669ecc8a2ad2eb70_MD5.jpg]] | ![[../ASLant_Files/eb54824eee8e1938db3721bbd9523479_MD5.jpg]] |
| --------------------------------------------------------------- | --------------------------------------------------------------- |
### CUBEMX 配置
![[../ASLant_Files/01dec2bfa3be47c2cc41717f6af41980_MD5.jpg]]

![[../ASLant_Files/62b5ac1bb244c49b49ab913c417c0db9_MD5.jpg]]

### 代码
```c
  /* USER CODE BEGIN 2 */
HAL_TIM_Base_Start_IT(&htim3);
ServoSetPluseAndTime(6, 1500, 1000);
ServoSetPluseAndTime(5, 1500, 1000);
ServoSetPluseAndTime(4, 1500, 1000);
ServoSetPluseAndTime(3, 1500, 1000);
ServoSetPluseAndTime(2, 1500, 1000);
ServoSetPluseAndTime(1, 1500, 1000);
int getTime = 0; // 保存当前的计数值
  /* USER CODE END 2 */
```

```c
 /* USER CODE BEGIN 3 */
if (HAL_GetTick() - getTime > 20)
{
  ServoPwmDutyCompare();
  getTime = HAL_GetTick();
}
/* USER CODE END 3 */
```

### 效果
 <div style="text-align: center;"><video src="https://s138.ananas.chaoxing.com/sv-w8/video/08/63/71/1d4b140dd925515d542620a75d139810/sd.mp4" width="50%" height="100%" controls="controls" class="rounded-video"></video></div>

# PWM 呼吸灯

![[../ASLant_Files/9b26b277edf68366ff3be1dab33eff7f_MD5.jpg]]
###### PWM 呼吸灯 TIM4  CHannel4  PB9

### 代码
```c
 HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_4);
 uint16_t pwmVal=0;   //PWM占空比
```

```c
while (pwmVal < 500)
{
    pwmVal++;
    __HAL_TIM_SetCompare(&htim4, TIM_CHANNEL_4, pwmVal);    //修改比较值，修改占空比
    HAL_Delay(1);
}
while (pwmVal)
{
    pwmVal--;
    __HAL_TIM_SetCompare(&htim4, TIM_CHANNEL_4, pwmVal);    //修改比较值，修改占空比
    HAL_Delay(1);
}
HAL_Delay(200);
```

### 效果

 <div style="text-align: center;"><video src="https://s138.ananas.chaoxing.com/sv-w8/video/b2/38/6d/251e91dfa059df8230c9e27204882ccf/sd.mp4" width="50%" height="100%" controls="controls" class="rounded-video"></video></div>